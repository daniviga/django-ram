{% extends 'base.html' %}
{% load dynamic_url %}

        {% block header %}
        {% if data.tags.all %}
        <p><small>Tags:</small>
          {% for t in data.tags.all %}<a href="{% url 'filtered' _filter="tag" search=t.slug %}" class="badge rounded-pill bg-primary">
          {{ t.name }}</a>{# new line is required #}
          {% endfor %}
        </p>
        {% endif %}
        {% if not data.published %}
        <span class="badge text-bg-warning">Unpublished</span> |
        {% endif %}
        <small class="text-body-secondary">Updated {{ data.updated_time | date:"M d, Y H:i" }}</small>
        {% endblock %}
        {% block carousel %}
        <div class="row">
          <div id="carouselControls" class="carousel carousel-dark slide" data-bs-ride="carousel" data-bs-interval="10000">
            <div class="carousel-inner">
              {% for t in data.image.all %}
              {% if forloop.first %}
              <div class="carousel-item active">
              {% else %}
              <div class="carousel-item">
              {% endif %}
                <img src="{{ t.image.url }}" class="d-block w-100 rounded img-thumbnail" alt="...">
              </div>
              {% endfor %}
            </div>
            {% if data.image.count > 1 %}
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselControls" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden"><i class="bi bi-chevron-left"></i></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselControls" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden"><i class="bi bi-chevron-right"></i></span>
            </button>
            {% endif %}
          </div>
        </div>
        {% endblock %}
        {% block cards %}
        {% endblock %}
        {% block extra_content %}
        <section class="py-4 text-start container">
          <div class="row">
            <div class="mx-auto">
              <nav class="nav nav-tabs d-none d-lg-flex flex-row mb-2" id="nav-tab" role="tablist">
                <button class="nav-link active" id="nav-summary-tab" data-bs-toggle="tab" data-bs-target="#nav-summary" type="button" role="tab" aria-controls="nav-summary" aria-selected="true">Summary</button>
                {% if data.toc.all %}<button class="nav-link" id="nav-toc-tab" data-bs-toggle="tab" data-bs-target="#nav-toc" type="button" role="tab" aria-controls="nav-toc" aria-selected="true">Table of contents</button>{% endif %}
                {% if documents %}<button class="nav-link" id="nav-documents-tab" data-bs-toggle="tab" data-bs-target="#nav-documents" type="button" role="tab" aria-controls="nav-documents" aria-selected="false">Documents</button>{% endif %}
              </nav>
              <select class="form-select d-lg-none mb-2" id="tabSelector" aria-label="Tab selector">
                <option value="nav-summary" selected>Summary</option>
                {% if data.toc.all %}<option value="nav-toc">Table of contents</option>{% endif %}
                {% if documents %}<option value="nav-documents">Documents</option>{% endif %}
              </select>
              <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane show active" id="nav-summary" role="tabpanel" aria-labelledby="nav-summary-tab">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th colspan="2" scope="row">
                          {{ data.obj_label|capfirst }}
                        </th>
                      </tr>
                    </thead>
                    <tbody class="table-group-divider">
                      {% if data.obj_type == "catalog" %}
                      <tr>
                        <th class="w-33" scope="row">Manufacturer</th>
                        <td>
                          <a href="{% url 'filtered' _filter="manufacturer" search=data.manufacturer.slug %}">{{ data.manufacturer }}{% if data.manufacturer.website %}</a> <a href="{{ data.manufacturer.website }}" target="_blank"><i class="bi bi-box-arrow-up-right"></i></a>{% endif %}
                        </td>
                      </tr>
                      <tr>
                        <th class="w-33" scope="row">Scales</th>
                        <td>{{ data.get_scales }}</td>
                      </tr>
                      {% elif data.obj_type == "book" %}
                      <tr>
                        <th class="w-33" scope="row">Title</th>
                        <td>{{ data.title }}</td>
                      </tr>
                      <tr>
                        <th class="w-33" scope="row">Authors</th>
                        <td>
                          <ul class="mb-0 list-unstyled">{% for a in data.authors.all %}<li>{{ a }}</li>{% endfor %}</ul>
                        </td>
                      </tr>
                      <tr>
                        <th class="w-33" scope="row">Publisher</th>
                        <td>
                          <img src="{{ data.publisher.country.flag }}" alt="{{ data.publisher.country }}"> {{ data.publisher }}
                          {% if data.publisher.website %} <a href="{{ data.publisher.website }}" target="_blank"><i class="bi bi-box-arrow-up-right"></i></a>{% endif %}
                        </td>
                      </tr>
                      {% elif data.obj_type == "magazineissue" %}
                      <tr>
                        <th class="w-33" scope="row">Magazine</th>
                        <td>
                          <a href="{% url 'magazine' data.magazine.pk %}">{{ data.magazine }}</a>
                          {% if data.magazine.website %} <a href="{{ data.magazine.website }}" target="_blank"><i class="bi bi-box-arrow-up-right"></i></a>{% endif %}
                        </td>
                      </tr>
                      <tr>
                        <th class="w-33" scope="row">Publisher</th>
                        <td>
                          <img src="{{ data.publisher.country.flag }}" alt="{{ data.publisher.country }}"> {{ data.publisher }}
                          {% if data.publisher.website %} <a href="{{ data.publisher.website }}" target="_blank"><i class="bi bi-box-arrow-up-right"></i></a>{% endif %}
                        </td>
                      </tr>
                      <tr>
                        <th class="w-33" scope="row">Issue</th>
                        <td>{{ data.issue_number }}</td>
                      </tr>
                      <tr>
                        <th class="w-33" scope="row">Date</th>
                        <td>{{ data.publication_year|default:"-" }} / {{ data.get_publication_month_display|default:"-" }}</td>
                      </tr>
                      {% endif %}
                      <tr>
                        <th scope="row">ISBN</th>
                        <td>{{ data.ISBN|default:"-" }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Language</th>
                        <td>{{ data.get_language_display }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Number of pages</th>
                        <td>{{ data.number_of_pages|default:"-" }}</td>
                      </tr>
                      {% if data.obj_type == "book" or data.obj_type == "catalog" %}
                      <tr>
                        <th scope="row">Publication year</th>
                        <td>{{ data.publication_year|default:"-" }}</td>
                      </tr>
                      {% endif %}
                      {% if data.description %}
                      <tr>
                        <th class="w-33" scope="row">Description</th>
                        <td>{{ data.description | safe }}</td>
                      </tr>
                      {% endif %}
                    </tbody>
                  </table>
                  {% if request.user.is_staff %}
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th colspan="2" scope="row">Purchase</th>
                      </tr>
                    </thead>
                    <tbody class="table-group-divider">
                      <tr>
                        <th class="w-33" scope="row">Shop</th>
                        <td>
                          {{ data.shop|default:"-" }}
                          {% if data.shop.website %} <a href="{{ data.shop.website }}" target="_blank"><i class="bi bi-box-arrow-up-right"></i></a>{% endif %}
                        </td>
                      </tr>
                      <tr>
                        <th class="w-33" scope="row">Purchase date</th>
                        <td>{{ data.purchase_date|default:"-" }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Price ({{ site_conf.currency }})</th>
                        <td>{{ data.price|default:"-" }}</td>
                      </tr>
                    </tbody>
                  </table>
                  {% endif %}
                  {% if properties %}
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th colspan="2" scope="row">Properties</th>
                      </tr>
                    </thead>
                    <tbody class="table-group-divider">
                    {% for p in properties %}
                      <tr>
                        <th class="w-33" scope="row">{{ p.property }}</th>
                        <td>{{ p.value }}</td>
                      </tr>
                    {% endfor %}
                    </tbody>
                  </table>
                  {% endif %}
                </div>
                <div class="tab-pane table-responsive" id="nav-toc" role="tabpanel" aria-labelledby="nav-toc-tab">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th scope="row">Title</th>
                        <th scope="row">Subtitle</th>
                        <th scope="row">Authors</th>
                        <th scope="row">Page</th>
                        <th scope="row"><abbr title="Featured article"><i class="bi bi-star-fill"></i></abbr></th>
                      </tr>
                    </thead>
                    <tbody class="table-group-divider">
                      {% for toc in data.toc.all %}
                      <tr>
                        <td class="w-33">{{ toc.title }}</td>
                        <td class="w-33">{{ toc.subtitle }}</td>
                        <td>{{ toc.authors }}</td>
                        <td>{{ toc.page }}</td>
                          <td>{% if toc.featured %}<abbr title="Featured article"><i class="bi bi-star-fill text-warning"></i></abbr>{% endif %}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
                <div class="tab-pane" id="nav-documents" role="tabpanel" aria-labelledby="nav-documents-tab">
                  {% include "includes/documents.html" %}
                </div>
              </div>
              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                {% if request.user.is_staff %}<a class="btn btn-sm btn-outline-danger" href="{% dynamic_admin_url 'bookshelf' data.obj_type data.pk %}">Edit</a>{% endif %}
              </div>
            </div>
          </div>
        </section>
        {% endblock %}
